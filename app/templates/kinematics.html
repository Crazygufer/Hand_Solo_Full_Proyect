<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='kinematics.css') }}">
    <title>Handi Project - Cinemáticas</title>
    <style>
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .matrix-table td, .matrix-table th {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .matrix-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .matrix-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <header class="header-container">
        <img src="{{ url_for('static', filename='images/logo_5_transparent.png') }}" alt="Logo">
        <a href="{{ url_for('panel') }}">HANDI</a>
        <h1 class="kinematics-title">Kinematics</h1>
    </header>
    
    <nav>
        <ul>
            <li><a href="{{ url_for('transcripcion') }}">Transcripción de Voz</a></li>
            <li><a href="{{ url_for('vision_artificial') }}">Visión Artificial</a></li>
            <li><a href="{{ url_for('kinematics') }}">Kinematics</a></li>
            <li><a href="{{ url_for('modo_automatico') }}">Modo Automático</a></li>
        </ul>
    </nav>

    <main>
        <section class="content-panel">
            <div class="form-matrix-container">
                <div class="form-container">
                    <h2 class="section-title">Forward Kinematics</h2>
                    <form id="kinematics-form">
                        <label for="q1">Ángulo para q1 (°):</label>
                        <input type="number" id="q1" name="q1" required>
                        
                        <label for="q2">Ángulo para q2 (°):</label>
                        <input type="number" id="q2" name="q2" required>
                        
                        <label for="q3">Ángulo para q3 (°):</label>
                        <input type="number" id="q3" name="q3" required>
                        
                        <label for="q4">Ángulo para q4 (°):</label>
                        <input type="number" id="q4" name="q4" required>
                        
                        <label for="q5">Ángulo para q5 (°):</label>
                        <input type="number" id="q5" name="q5" required>
                        
                        <button type="submit">Calcular Cinemática</button>
                    </form>
                </div>

                <div class="matrix-container">
                    <h3>Matriz de Transformación:</h3>
                    <table id="matrix-output" class="matrix-table">
                        <!-- Filas y columnas se agregarán dinámicamente -->
                    </table>

                    <h3>Posición:</h3>
                    <p id="position-output">Px: ---, Py: ---, Pz: ---</p>

                    <h3>Ángulos de Euler:</h3>
                    <p id="euler-output">a: ---, b: ---, g: ---</p>

                    <p id="error-message" style="color: red;"></p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Handi Project</p>
    </footer>

    <script>
        document.getElementById("kinematics-form").addEventListener("submit", async (e) => {
            e.preventDefault();  // Prevenir que el formulario se envíe de forma tradicional
            
            // Capturar valores de los ángulos
            const data = {
                q1: parseFloat(document.getElementById("q1").value),
                q2: parseFloat(document.getElementById("q2").value),
                q3: parseFloat(document.getElementById("q3").value),
                q4: parseFloat(document.getElementById("q4").value),
                q5: parseFloat(document.getElementById("q5").value)
            };

            try {
                // Enviar la solicitud POST al servidor
                const response = await fetch("/Kinematics", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error("Error en la respuesta del servidor");
                }

                // Manejar la respuesta
                const result = await response.json();
                document.getElementById("error-message").innerText = "";  // Limpiar mensaje de error anterior

                // Mostrar la matriz de transformación en formato de tabla
                const matrixTable = document.getElementById("matrix-output");
                matrixTable.innerHTML = ""; // Limpiar contenido previo

                let matrix = result.matrix;
                
                // Asegurarse de que `matrix` sea un array de arrays
                if (typeof matrix === "string") {
                    matrix = JSON.parse(matrix);
                }

                matrix.forEach(row => {
                    const tr = document.createElement("tr");
                    row.forEach(value => {
                        const td = document.createElement("td");
                        td.innerText = parseFloat(value).toFixed(4); // Mostrar con 4 decimales
                        tr.appendChild(td);
                    });
                    matrixTable.appendChild(tr);
                });

                // Mostrar la posición Px, Py, Pz
                document.getElementById("position-output").innerText = `Px: ${result.Px}, Py: ${result.Py}, Pz: ${result.Pz}`;

                // Mostrar los ángulos de Euler a, b, g
                document.getElementById("euler-output").innerText = `a: ${result.a}, b: ${result.b}, g: ${result.g}`;
            } catch (error) {
                // Mostrar mensaje de error
                document.getElementById("error-message").innerText = error.message || "Error desconocido";
                console.error("Error al realizar la solicitud:", error);
            }
        });
    </script>
</body>
</html>
